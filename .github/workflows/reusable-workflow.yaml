name: Reuable workflow
on:
 workflow_call:
  inputs:
    docker_url:
     required: true
     type: string
jobs:
 install-prerequistes:
   runs-on: ubuntu-latest
   steps:
     - name: install terraform
       run: |
         echo "------ Installing Terraform ------"
         wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null
         wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null
         gpg --no-default-keyring --keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg --fingerprint
         echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list        
         sudo apt update 
         sudo apt-get install terraform
         terraform -help
 Build:
   runs-on: ubuntu-latest
   needs: install-prerequistes
   steps:
     - name: Checkout code
       uses: actions/checkout@v2
     - name: build
       run: |
        mvn compile
        mvn package
 Unit-Test:
   runs-on: ubuntu-latest
   needs: install-prerequistes
   steps:
     - name: Checkout code
       uses: actions/checkout@v2
     - name: Unit Test
       run: |
        mvn test     
 Docker-Build:      
   runs-on: ubuntu-latest
   needs: Build
   steps:
     - name: checout code
       uses: actions/checkout@v2
     - name: Docker Build
       run: |
        echo ${{ inputs.docker_url }}
        echo Docker Build Started...
 Publish-Docker-Image:
   runs-on: ubuntu-latest
   needs: Docker-Build
   environment: ${GITHUB_REF##*/}
   steps: 
     - name: checout code
       uses: actions/checkout@v2
     - name: Docker publish
       run: |
        echo "pushing to docker registory: $DOCKER_URI"
       env:
         DOCKER_URI: ${{ vars.DOCKER_URI }}  
  
     
